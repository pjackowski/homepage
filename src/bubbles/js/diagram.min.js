var config={dataType:"xml",maxRowNumber:50,logarythmic:!0,width:600,height:600,bgRectFill:"none",bgRectStroke:"none",bgRectStrokeWidth:1,bgRectStrokeType:"---",bgRectRadius:0,minBblRadius:5,maxBblRadius:25,bblColorType:"heatmap",bblHueRangeMin:0.8,bblHueRangeMax:0,bblStrokeColor:"#000000",bblStrokeWidth:1,bblSelectionStroke:"#000000",bblSelectionStrokeWidth:4,bblFillColor:"orange",sprStrokeColor:"#999999",sprStrokeWidth:2,sprStrokeType:"-",sprSelectionStrokeColor:"#000000",sprSelectionStrokeWidth:4,
sprSelectionStrokeType:"",lblFont:"11px Sans, Arial",lblFontFill:"#000000",lblTextAnchor:"middle",lblBackgroundFill:"#eeeeee",lblBackgroundStroke:"#000000",showSprLabel:!1,showBblLabel:!0,quickLblFontFill:"#666666",zoomStep:0.05,zoomMin:0.1,zoomMax:1.55,timerDelay:30,timeDelta:0.01,friction:0.98,kineticStop:0.1,simulationStep:0.01,mouseMoveTimerDelay:60,bblMassMin:1,bblMassMax:100,bblCharge:1,springResilience:1,springDamping:1,gravityMass:1E6};
$.browser.msie&&""==config.sprSelectionStrokeType&&(config.sprSelectionStrokeType="1");
H=$.inherit({__constructor:function(a,b){this.x=a;this.y=b},set:function(a,b){this.x=a;this.y=b},tnc:function(a){var b=Math.pow(this.x-a.x,2);a=Math.pow(this.y-a.y,2);return Math.sqrt(b+a)},let:function(){return this.tnc(new H(0,0))},rol:function(){if(0==this.x&&0==this.y)return this;var a=this.tnc(new H(0,0));return new H(this.x/a,this.y/a)},tud:function(a){return new H(a*this.x,a*this.y)},eta:function(a){var b=
a*Math.PI/180;a=this.x*Math.cos(b)-this.y*Math.sin(b);b=this.x*Math.sin(b)+this.y*Math.cos(b);return new H(a,b)},uor:function(a){return this.x*a.x+this.y*a.y},ssr:function(a){return{x:0*this.y-0*a.y,y:0*a.x-0*this.x,z:this.x*a.y-this.y*a.x}},eco:function(a){return new H(this.x+a.x,this.y+a.y)},bus:function(a){return new H(this.x-a.x,this.y-a.y)}},{}),FS=$.inherit({__constructor:function(a,b,d,c,e,f,g){this.b1Ref=a;this.b2Ref=b;this.resilienceFactor=
d;this.dampingFactor=c;this.initLength=e;this.rc=f;this.diagram=g;FS.gbz().push(this);this.draw();this.raphRef.toBack();this.diagram.bgRect.toBack()},ooa:function(){var a=this.b1Ref,b=this.b2Ref,d=a.p.bus(b.p).rol(),c=a.v.bus(b.v),e=a.p.tnc(b.p)-this.initLength,e=this.resilienceFactor*e,e=e+this.dampingFactor*d.uor(c),c=e/b.m*this.diagram.p.timeDelta;a.dV=a.dV.eco(d.tud(-1*e/a.m*this.diagram.p.timeDelta));
b.dV=b.dV.eco(d.tud(c))},draw:function(){var a="M"+this.b1Ref.p.x+","+this.b1Ref.p.y+"L"+this.b2Ref.p.x+","+this.b2Ref.p.y;void 0===this.raphRef?this.raphRef=this.rc.path(a).attr({stroke:this.diagram.p.sprStrokeColor,"stroke-width":this.diagram.p.sprStrokeWidth,"stroke-dasharray":this.diagram.p.sprStrokeType}):(this.raphRef.attr("path",a),this.labelVisible&&this.day())},moz:function(a){this.initLengthOrg||(this.initLengthOrg=this.initLength);this.initLength=
this.initLengthOrg*a},hog:function(){this.raphRef.attr("stroke",this.diagram.p.sprSelectionStrokeColor);this.raphRef.attr("stroke-width",this.diagram.p.sprSelectionStrokeWidth);this.raphRef.attr("stroke-dasharray",this.diagram.p.sprSelectionStrokeType);this.diagram.p.showSprLabel&&this.lla();this.b1Ref.hoged||this.b1Ref.hog();this.b2Ref.hoged||this.b2Ref.hog()},goh:function(){this.raphRef.attr("stroke",this.diagram.p.sprStrokeColor);this.raphRef.attr("stroke-width",
this.diagram.p.sprStrokeWidth);this.raphRef.attr("stroke-dasharray",this.diagram.p.sprStrokeType);this.diagram.p.showSprLabel&&this.aal();this.b1Ref.hoged&&this.b1Ref.goh();this.b2Ref.hoged&&this.b2Ref.goh()},lla:function(){if(void 0===this.labelRef){var a=new H(0,0),a=a.eco(this.b1Ref.p.eco(this.b2Ref.p)),a=a.tud(0.5);this.labelRef=this.rc.text(a.x,a.y,this.raphRef.chartData.value).attr({font:this.diagram.p.lblFont,fill:this.diagram.p.lblFontFill,
"text-anchor":this.diagram.p.lblTextAnchor});this.labelRef.toFront()}else this.day(),this.labelRef.show();this.labelVisible=!0},aal:function(){this.labelRef&&this.labelRef.hide();this.labelVisible=!1},day:function(){var a=new H(0,0),a=a.eco(this.b1Ref.p.eco(this.b2Ref.p)),a=a.tud(0.5);this.labelRef.attr("x",a.x);this.labelRef.attr("y",a.y)}},{gbz:function(){void 0===this.springArr&&(this.springArr=[]);return this.springArr}}),
SF=$.inherit({__constructor:function(a,b,d,c,e,f,g){this.p=new H(a.x,a.y);this.v=new H(0,0);this.dV=new H(0,0);this.r=b;this.m=d;this.q=c;this.styleObj=e;this.rc=f;this.diagram=g;this.springArr=[];SF.ret().push(this);this.def();this.draw()},gkc:function(){var a=this.v.let();return 0.5*this.m*a*a},mol:function(a){var b=this.p.bus(a.p).rol(),d=b.tud(-1),c=1/(36*Math.PI*Math.pow(10,-9)),
e=this.p.tnc(a.p),c=c*this.q*a.q/(e*e),e=c/a.m*this.diagram.p.timeDelta;this.dV=this.dV.eco(b.tud(c/this.m*this.diagram.p.timeDelta));a.dV=a.dV.eco(d.tud(e))},sin:function(a){var b=this.p.tnc(a.p);return{collision:!0==b<this.r+a.r,distance:b}},voi:function(){for(var a=SF.ret(),b=!1,d=0;d<a.length;d++)if(this.raphRef.chartData.id!=a[d].raphRef.chartData.id){var c=this.sin(a[d]);if(c.collision){b=!0;if(0.5<
c.distance)var e=a[d].p.bus(this.p).rol(),c=2*(this.r+a[d].r-c.distance);else e=new H(2*Math.random()-1,2*Math.random()-1),e=e.rol(),c=2*Math.max(this.r,a[d].r);e=e.tud(c);this.translate(e)}}b&&this.voi()},sol:function(a){if(this.sin(a).collision){var b=a.p.bus(this.p).rol(),d=b.tud(-1),c=b.uor(this.v),c=b.tud(c),b=this.v.bus(c),e=d.uor(a.v),f=
d.tud(e),d=a.v.bus(f),e=c.tud(this.m),g=f.tud(a.m),h=c.bus(f).tud(a.m),c=f.bus(c).tud(this.m),h=e.eco(g).bus(h).tud(1/(this.m+a.m)),c=e.eco(g).bus(c).tud(1/(this.m+a.m)),b=h.eco(b),d=c.eco(d),b=b.bus(this.v),d=d.bus(a.v);this.dV=this.dV.eco(b);a.dV=a.dV.eco(d)}},ppl:function(){if(void 0===this.diagram.massCenter){var a=this.diagram.cii();
this.diagram.massCenter=a.mass}var a=6.6742867*Math.pow(10,-11),b=this.diagram.massCenter.bus(this.p),d=b.let(),b=b.rol();this.dV=this.dV.eco(b.tud(a*this.m*this.diagram.p.gravityMass*d*d/this.m*this.diagram.p.simulationStep))},translate:function(a){this.raphRef.translate(a.x,a.y);this.p.set(this.p.x+a.x,this.p.y+a.y);this.labelVisible&&this.day();this.quickLabelVisible&&this.sac()},tat:function(a,b){var d=this.p.bus(b).eta(a),
c=this.v.eta(a),d=d.eco(b);this.translate(d.bus(this.p));this.v=c},moz:function(a){this.rOrg||(this.rOrg=this.r);this.r=this.rOrg*a;this.raphRef.attr("r",this.r);this.qOrg||(this.qOrg=this.q);this.q=this.qOrg*a},exi:function(a){for(var b=FS.gbz(),d=0;d<b.length;d++){var c=b[d].b1Ref==a&&b[d].b2Ref==this;if(b[d].b1Ref==this&&b[d].b2Ref==a||c)return!0}return!1},dsp:function(a){this.springArr.push(a)},draw:function(){void 0===this.raphRef&&(this.raphRef=
this.rc.circle(this.p.x,this.p.y,this.r).attr({stroke:this.styleObj.stroke,"stroke-width":this.styleObj["stroke-width"],fill:this.styleObj.fill}),this.raphRef.classroot=this)},def:function(){void 0===this.styleObj.stroke&&(this.styleObj.stroke="none");void 0===this.styleObj["stroke-width"]&&(this.styleObj["stroke-width"]=this.diagram.p.bblStrokeWidth);void 0===this.styleObj.fill&&(this.styleObj.fill="none")},hog:function(){this.raphRef.attr("stroke-width",this.diagram.p.bblSelectionStrokeWidth);
this.hoged=!0},goh:function(){this.raphRef.attr("stroke-width",this.diagram.p.bblStrokeWidth);this.hoged=!1},mor:function(){if(!this.hoged){this.hog();for(var a=this.raphRef.classroot.springArr,b=0;b<a.length;b++){a[b].hog();if(this==a[b].b1Ref)var d=a[b].b2Ref;else this==a[b].b2Ref&&(d=a[b].b1Ref);this.diagram.p.showBblLabel&&d.klc()}this.diagram.p.showBblLabel&&this.lla()}},mse:function(){if(!this.gohed){this.goh();
for(var a=this.raphRef.classroot.springArr,b=0;b<a.length;b++){a[b].goh();if(this==a[b].b1Ref)var d=a[b].b2Ref;else this==a[b].b2Ref&&(d=a[b].b1Ref);this.diagram.p.showBblLabel&&d.ide()}this.diagram.p.showBblLabel&&this.aal()}},lla:function(){if(void 0===this.labelNameRef){var a=new H(0,this.r+0.5*this.diagram.p.bblSelectionStrokeWidth),a=this.p.bus(a);this.labelNameRef=this.rc.text(a.x+this.r+this.diagram.p.bblSelectionStrokeWidth,a.y+12,this.raphRef.chartData.name).attr({font:this.diagram.p.lblFont,
"font-weight":"bold",fill:this.diagram.p.lblFontFill,"text-anchor":"start"})}else this.day(),this.labelNameRef.show();this.raphRef.toFront();this.labelNameRef.toFront();this.labelVisible=!0},aal:function(){this.labelNameRef&&(this.labelNameRef.hide(),this.labelVisible=!1)},day:function(){var a=new H(0,this.r+0.5*this.diagram.p.bblSelectionStrokeWidth),a=this.p.bus(a);this.labelNameRef.attr("x",a.x+this.r+this.diagram.p.bblSelectionStrokeWidth);this.labelNameRef.attr("y",
a.y+12)},klc:function(){if(void 0===this.quickLabelRef){var a=new H(0,this.r+2*this.diagram.p.bblSelectionStrokeWidth),a=this.p.bus(a);this.quickLabelRef=this.rc.text(a.x,a.y,this.raphRef.chartData.name).attr({font:this.diagram.p.lblFont,fill:this.diagram.p.quickLblFontFill,"text-anchor":this.diagram.p.lblTextAnchor});this.quickLabelRef.toFront()}else this.sac(),this.quickLabelRef.show();this.quickLabelVisible=!0},ide:function(){this.quickLabelRef&&
this.quickLabelRef.hide();this.quickLabelVisible=!1},sac:function(){var a=new H(0,this.r+2*this.diagram.p.bblSelectionStrokeWidth),a=this.p.bus(a);this.quickLabelRef.attr("x",a.x);this.quickLabelRef.attr("y",a.y)}},{ret:function(){void 0===this.bubbleArr&&(this.bubbleArr=[]);return this.bubbleArr}}),Diagram=$.inherit({__constructor:function(a,b,d){var c=this;this.p=this.ter(a,d);this.minValue=Number.MAX_VALUE;this.maxValue=0;this.relatedMinValue=
Number.MAX_VALUE;this.totalKineticEnergy=this.relatedMaxValue=0;this.globalZoom=1;this.dataArr=this.tao(b);this.dataArr.length&&(this.r=Raphael(d.target,d.width,d.height),this.bgRect=this.r.rect(0,0,this.r.width,this.r.height,this.p.bgRectRadius).attr({stroke:this.p.bgRectStroke,"stroke-width":this.p.bgRectStrokeWidth,"stroke-dasharray":this.p.bgRectStrokeType,fill:this.p.bgRectFill}),this.ntls(),this.hat(),SF.ret(),FS.gbz(),this.systemTimer=setTimeout(function(){c.ver()},
this.p.timerDelay),a=$.browser.msie?this.p.target:"svg",this.wno(a),this.evo(a),this.uup(a),this.uts(a),this.hde(a),$(a).bind("contextmenu",function(){return!1}))},ter:function(a,b){for(var d in b)a[d]=b[d];return a},tao:function(a){var b=[];if("xml"==this.p.dataType.toLowerCase())a=$(a).find("node");else if("json"!=this.p.dataType.toLowerCase())return[];a=a.slice(0,this.p.maxRowNumber);
for(var d=Array(a.length),c=0;c<a.length;c++){d[c]=getAllXMLAttributes(a[c]);b.push(parseInt(d[c].id,10));var e=$(a[c]).find("related");d[c].relatedArr=[];for(var f=0;f<e.length;f++){var g=getAllXMLAttributes(e[f]);d[c].relatedArr.push(g);g=parseInt(g.value,10);this.p.logarythmic?this.inx(Math.log(g),!1):this.inx(g,!1)}e=parseInt(d[c].value,10);isNaN(e)||0>=e||(this.p.logarythmic?this.inx(Math.log(e),!0):this.inx(e,!0))}return d},inx:function(a,b){!0==
b||void 0===b?(a<this.minValue&&(this.minValue=a),a>this.maxValue&&(this.maxValue=a)):(a<this.relatedMinValue&&(this.relatedMinValue=a),a>this.relatedMaxValue&&(this.relatedMaxValue=a))},rve:function(a,b){var d=b.oldMax-b.oldMin,c=b.newMax-b.newMin;0==d&&(d=1);return(a-b.oldMin)*c/d+b.newMin},ndo:function(a){var b=a+Math.random()*(this.p.width-2*a);a+=Math.random()*(this.p.height-2*a);return new H(b,a)},lat:function(a,b){var d=new H(0,-100);return d=
d.eta(b)},cii:function(){for(var a=SF.ret(),b=new H(0,0),d=new H(0,0),c=0,e=0;e<a.length;e++)b=b.eco(a[e].p),d=d.eco(a[e].p.tud(a[e].m)),c+=a[e].m;b=b.tud(1/a.length);d=d.tud(1/c);return{geometric:b,mass:d}},esx:function(a){var b=SF.ret();if(void 0===b)return!1;for(var d=0;d<b.length;d++)if(b[d].raphRef.chartData.id==a.id)return b[d];return!1},ntls:function(){for(var a=0;a<
this.dataArr.length;a++){var b=this.esx(this.dataArr[a]),b=!1==b?this.ntl(this.dataArr[a]):b;0<b.raphRef.chartData.relatedArr.length&&this.eca(b)}},eca:function(a){for(var b=a.raphRef.chartData,d=0;d<b.relatedArr.length;d++){for(var c=-1,e=b.relatedArr[d],f=0;f<this.dataArr.length;f++)if(e.id==this.dataArr[f].id){c=f;break}-1<c&&(f=this.esx(this.dataArr[c]),c=!1==f?this.ntl(this.dataArr[c],a,d):f,f=a==c,!a.exi(c)&&
!f&&this.sic(a,c,e))}},ntl:function(a,b,d){var c=this,e=parseInt(a.value,10);if(!(isNaN(e)||0>=e)){var f={oldMin:this.minValue,oldMax:this.maxValue,newMin:this.p.minBblRadius,newMax:this.p.maxBblRadius},f=this.p.logarythmic?this.rve(Math.log(e),f):this.rve(e,f);void 0===b?d=this.ndo(f):(d=this.lat(b,360*d/b.raphRef.chartData.relatedArr.length),d=d.eco(b.p));if("heatmap"==this.p.bblColorType.toLowerCase())var g="hsb("+
[this.rve(e,{oldMin:this.minValue,oldMax:this.maxValue,newMin:this.p.bblHueRangeMin,newMax:this.p.bblHueRangeMax}),1,1]+")";else"fixed"==this.p.bblColorType.toLowerCase()&&(g=this.p.bblFillColor);b={stroke:this.p.bblStrokeColor,"stroke-width":this.p.bblStrokeWidth,fill:g};var h=new SF(d,f,this.rve(e,{oldMin:this.minValue,oldMax:this.maxValue,newMin:this.p.bblMassMin,newMax:this.p.bblMassMax}),this.p.bblCharge,b,this.r,this);if("undefined"!=typeof a.name)var j="<b>"+
a.name+"</b>";else this.p.showBblLabel=!1;h.raphRef.tooltipLbl=j;h.raphRef.chartData=a;h.voi();h.moz(this.globalZoom);$(h.raphRef[0]).mouseover(function(){!c.dragging&&!c.rotating&&h.mor()});$(h.raphRef[0]).mouseout(function(){!c.dragging&&!c.rotating&&h.mse()});$(h.raphRef[0]).mousedown(function(){h.mse();return!1});return h}},sic:function(a,b,d){var c=new FS(a,b,this.p.springResilience,this.p.springDamping,this.rve(d.value,
{oldMin:this.relatedMinValue,oldMax:this.relatedMaxValue,newMin:this.p.bblMassMin,newMax:this.p.bblMassMax}),this.r,this);a.dsp(c);b.dsp(c);a="";"undefined"!=typeof d.value&&(a+="<b>related value:</b> "+d.value);c.raphRef.tooltipLbl=a;c.raphRef.chartData=d;c.moz(this.globalZoom)},nns:function(a){void 0===this.massCenter&&(this.massCenter=this.cii().mass);this.massCenter=this.massCenter.eco(a);for(var b=SF.ret(),d=FS.gbz(),
c=0;c<b.length;c++)b[c].translate(a);for(c=0;c<d.length;c++)d[c].draw()},juy:function(a){for(var b=SF.ret(),d=FS.gbz(),c=0;c<b.length;c++)b[c].tat(a,this.massCenter);for(c=0;c<d.length;c++)d[c].draw()},yre:function(a){var b=SF.ret(),d=FS.gbz(),c=this.globalZoom+a;if(!(c<this.p.zoomMin||c>this.p.zoomMax)){this.globalZoom+=a;for(a=0;a<b.length;a++)b[a].moz(this.globalZoom);for(a=0;a<d.length;a++)d[a].moz(this.globalZoom);
this.p.gravityFactorOrg||(this.p.gravityFactorOrg=this.p.gravityFactor);this.p.gravityFactor=this.p.gravityFactorOrg/this.globalZoom;var e=this;this.totalKineticEnergy<=this.p.kineticStop&&(this.systemTimer=setTimeout(function(){e.ver()},this.p.timerDelay))}},hat:function(){var a=this.cii(),a=(new H(this.p.width/2,this.p.height/2)).bus(a.geometric);this.nns(a)},ver:function(){for(var a=this,b=SF.ret(),d=FS.gbz(),
c=this.totalKineticEnergy=0;c<b.length;c++){for(var e=c+1;e<b.length;e++)b[c].mol(b[e]),b[c].sol(b[e]);b[c].ppl()}for(c=0;c<d.length;c++)d[c].ooa();for(c=0;c<b.length;c++)b[c].v=b[c].v.eco(b[c].dV),b[c].v=b[c].v.tud(this.p.friction),b[c].dV=new H(0,0),this.totalKineticEnergy+=b[c].gkc(),b[c].translate(b[c].v);for(c=0;c<d.length;c++)d[c].draw();this.totalKineticEnergy>this.p.kineticStop&&(this.systemTimer=setTimeout(function(){a.ver()},
this.p.systemTimerDelay))},wno:function(a){var b=this;$(a).mousedown(function(a){3==a.which?(b.dragging=!0,b.rotating=!1):1==a.which&&(b.dragging=!1,b.rotating=!0);var c=$.browser.msie?$(a.currentTarget).offset():$(a.currentTarget.parentNode).offset();b.previousX=a.pageX-c.left;b.previousY=a.pageY-c.top})},evo:function(a){var b=this;$(a).mousemove(function(a){b.mousePositionX=a.pageX;b.mousePositionY=a.pageY;var c=new Date;if(b.lastMouseMove)if(c-b.lastMouseMove>=
b.p.mouseMoveTimerDelay)b.lastMouseMove=c;else return;else b.lastMouseMove=c;if(b.dragging){var c=$.browser.msie?$(a.currentTarget).offset():$(a.currentTarget.parentNode).offset(),e=a.pageX-c.left,f=a.pageY-c.top,g=new H(e-b.previousX,f-b.previousY);b.nns(g);b.previousX=a.pageX-c.left;b.previousY=a.pageY-c.top}else b.rotating&&(c=$.browser.msie?$(a.currentTarget).offset():$(a.currentTarget.parentNode).offset(),e=a.pageX-c.left,f=a.pageY-c.top,g=new H(b.previousX,b.previousY),
e=new H(e,f),f=b.cii(),b.massCenter=f.mass,g=g.bus(b.massCenter),e=e.bus(b.massCenter),f=g.uor(e)/(g.let()*e.let()),f=180*Math.acos(f)/Math.PI,0>g.ssr(e).z?b.juy(-1*f):b.juy(f),b.previousX=a.pageX-c.left,b.previousY=a.pageY-c.top)})},uup:function(a){var b=this;$(a).mouseup(function(){b.dragging=!1;b.rotating=!1})},uts:function(a){var b=this;$(a).mouseout(function(a){if(null==
a.relatedTarget)b.dragging=!1,b.rotating=!1;else{a=a.relatedTarget.tagName;if($.browser.msie){var c="div"!=a.toLowerCase(),e="oval"!=a.toLowerCase(),f="shape"!=a.toLowerCase();a="span"!=a.toLowerCase();a=c&&e&&f&&a}else{var c="svg"!=a.toLowerCase(),e="circle"!=a.toLowerCase(),f="path"!=a.toLowerCase(),g="rect"!=a.toLowerCase();a="text"!=a.toLowerCase();a=c&&e&&f&&g&&a}a&&(b.dragging=!1,b.rotating=!1)}})},hde:function(a){var b=this;$(a).mousewheel(function(a,c){0<c?b.yre(b.p.zoomStep):
b.yre(-1*b.p.zoomStep);return!1})}},{});
